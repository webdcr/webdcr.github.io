---
layout: default
title: Home
permalink: /
preload_listen_icon_hover: true
---

<div class="home-content">
  <img
    src="/assets/images/wdcr-fish.gif"
    alt="WebDCR fish"
    class="home-logo"
  />
  <h1>Radio of, by, and for the students.</h1>
  <div class="listen-button-wrapper" x-data="listenButtonApp()" x-init="init()">
    <button
      class="button listen-button"
      id="listenButton"
      type="button"
      x-ref="button"
      :class="{ 'listen-button--active': isActive() }"
      :aria-disabled="isActive().toString()"
      :disabled="isActive()"
      @click.prevent="handleClick"
      @pointerdown="onPointerDown($event)"
      @pointerup="onPointerUp($event)"
      @pointercancel="onPointerUp($event)"
      @pointerleave="onPointerLeave($event)"
      @keydown.enter.prevent="onKeyDown()"
      @keydown.space.prevent="onKeyDown()"
      @keyup.enter.prevent="onKeyUp()"
      @keyup.space.prevent="onKeyUp()"
      @blur="onBlur($event)"
      @mouseenter="onMouseEnter($event)"
      @mouseleave="onMouseLeave($event)"
      @mousemove="onMouseMove($event)"
      @mousedown="onMouseDown()"
      @mouseup="onMouseUp()"
    >
      <span class="listen-button-content">
        <span class="listen-button-label">Listen live</span>
        <img
          x-ref="icon"
          :src="iconSrc"
          alt=""
          class="listen-button-icon"
          aria-hidden="true"
        />
      </span>
    </button>
    <template x-if="isDesktop">
      <img
        x-ref="cursor"
        :src="cursorSrc"
        alt=""
        class="listen-button-cursor"
        id="listenButtonCursor"
        aria-hidden="true"
        :class="{ visible: cursorVisible, 'listen-button-cursor--no-transition': disableCursorTransition }"
        :style="cursorStyle()"
      />
    </template>
  </div>

  <section x-data="scheduleApp()" x-init="init()">
    <div class="schedule-header">
      <h2>{{ site.term }} Show Schedule</h2>
    </div>
    <div class="day-selector-group">
      <template x-for="day in daysOfWeek" :key="day">
        <button
          class="selectDay"
          type="button"
          :class="{ selectedSelectDay: activeDay === day }"
          @click="selectDay(day)"
          x-text="day.toLowerCase()"
        ></button>
      </template>
    </div>

    <template x-for="day in daysOfWeek" :key="`panel-${day}`">
      <div class="daydiv" x-show="activeDay === day" x-transition.opacity>
        <h2 x-text="day"></h2>
        <template x-if="hasShows(day)">
          <table class="schedule-table">
            <template x-for="show in groupedShows[day]" :key="show.uid">
              <tr class="showRow" :class="{ 'showRow--live': !show.isBreak && isLive(show), 'showRow--break': show.isBreak }">
                <td class="showRowImage" :class="{ 'showRowImage--hidden': show.isBreak }">
                  <template x-if="!show.isBreak">
                    <img :src="show.imageSrc" :alt="show.imageAlt" />
                  </template>
                </td>
                <td class="showRowInfo">
                  <div class="showRowBreakContent" x-show="show.isBreak" x-cloak>
                    <span class="showRowBreakLabel">Programming break</span>
                    <template x-if="show.breakRange">
                      <span class="showRowBreakTime" x-text="show.breakRange"></span>
                    </template>
                  </div>
                  <div x-show="!show.isBreak" x-cloak>
                    <span class="showRowName" x-text="show.Name"></span>
                    <template x-if="show.hostLabel">
                      <span class="showRowHost" x-text="show.hostLabel"></span>
                    </template>
                    <p class="showRowDescription" x-text="show.Description"></p>
                  </div>
                </td>
                <td class="showRowTime" :class="{ 'showRowTime--hidden': show.isBreak }">
                  <template x-if="!show.isBreak">
                    <span class="showRowTimeContent">
                      <span class="showRowTimeText" x-text="show.displayTime"></span>
                    </span>
                  </template>
                </td>
              </tr>
            </template>
          </table>
        </template>
        <template x-if="!hasShows(day)">
          <p>No shows scheduled.</p>
        </template>
      </div>
    </template>
  </section>

  <img class="circle-image" src="/assets/images/shirts.jpg" alt="WebDCR merchandise" />
</div>
<script>
  const HAND_NORMAL = '/assets/images/hand1.png';
  const HAND_ACTIVE = '/assets/images/hand2.png';
  const HAND_GRAYED = '/assets/images/hand1-gray.png';

  document.addEventListener('alpine:init', () => {
    const DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const getEasternNow =
      window.webdcr && typeof window.webdcr.getEasternNowComponents === 'function'
        ? window.webdcr.getEasternNowComponents
        : function basicEasternNow() {
            const now = new Date();
            return {
              dayName: DAY_NAMES[now.getDay()] || DAY_NAMES[0],
              minutes: now.getHours() * 60 + now.getMinutes()
            };
          };
    Alpine.data('listenButtonApp', () => ({
      iconSrc: HAND_NORMAL,
      cursorSrc: HAND_NORMAL,
      cursorVisible: false,
      cursorPosition: { x: 0, y: 0 },
      disableCursorTransition: false,
      isDesktop:
        typeof window !== 'undefined' && typeof window.matchMedia === 'function'
          ? window.matchMedia('(hover: hover) and (pointer: fine)').matches
          : true,
      hideTimeout: null,
      isPointerDown: false,
      isHovering: false,
      init() {
        this.setupDesktopDetector();
        if (this.isDesktop) {
          this.$nextTick(() => {
            this.moveCursorToAnchor(true);
          });
        }
        this.updateVisualState();
        this.$watch('$store.radioPlayer.state', () => {
          this.updateVisualState();
          if (this.isDesktop && !this.cursorVisible) {
            this.moveCursorToAnchor(true);
          }
        });
        window.addEventListener('resize', () => {
          if (!this.isDesktop) {
            return;
          }
          if (!this.cursorVisible) {
            this.moveCursorToAnchor(true);
          }
        });
      },
      setupDesktopDetector() {
        if (typeof window === 'undefined' || typeof window.matchMedia !== 'function') {
          this.isDesktop = true;
          return;
        }
        const query = window.matchMedia('(hover: hover) and (pointer: fine)');
        const update = () => {
          const wasDesktop = this.isDesktop;
          this.isDesktop = query.matches;
          if (!this.isDesktop) {
            this.setCursorVisible(false);
            this.setButtonCursorHidden(false);
          } else if (!wasDesktop) {
            this.$nextTick(() => {
              this.moveCursorToAnchor(true);
            });
          }
        };
        update();
        if (typeof query.addEventListener === 'function') {
          query.addEventListener('change', update);
        } else if (typeof query.addListener === 'function') {
          query.addListener(update);
        }
      },
      cursorStyle() {
        return `left: ${this.cursorPosition.x}px; top: ${this.cursorPosition.y}px;`;
      },
      isActive() {
        const state = this.$store.radioPlayer ? this.$store.radioPlayer.state : 'stopped';
        return state === 'playing' || state === 'loading';
      },
      handSrc() {
        return this.isActive() ? HAND_GRAYED : HAND_NORMAL;
      },
      updateVisualState() {
        const src = this.handSrc();
        this.iconSrc = src;
        if (!this.isPointerDown) {
          this.cursorSrc = src;
        }
      },
      handleClick() {
        if (this.isActive()) {
          const playerBtn = document.getElementById('radioPlayer');
          if (playerBtn) {
            playerBtn.focus();
          }
        } else if (this.$store.radioPlayer) {
          this.$store.radioPlayer.toggle();
        }
        this.$nextTick(() => {
          this.blurButton();
        });
      },
      blurButton() {
        if (this.$refs.button && typeof this.$refs.button.blur === 'function') {
          this.$refs.button.blur();
        }
      },
      setButtonCursorHidden(state) {
        if (this.$refs.button) {
          this.$refs.button.classList.toggle('cursor-hidden', !!state);
        }
      },
      setCursorVisible(state) {
        if (!this.isDesktop) {
          this.cursorVisible = false;
          this.setButtonCursorHidden(false);
          return;
        }
        this.cursorVisible = !!state;
        this.setButtonCursorHidden(this.cursorVisible);
      },
      isMousePointer(event) {
        if (!this.isDesktop) {
          return false;
        }
        return !event || !event.pointerType || event.pointerType === 'mouse';
      },
      onPointerDown(event) {
        if (!this.isMousePointer(event) && event.pointerType) {
          this.isPointerDown = true;
          if (!this.isActive()) {
            this.iconSrc = HAND_ACTIVE;
          }
          return;
        }
        if (event.pointerType === 'mouse' && event.button !== 0) {
          return;
        }
        this.isPointerDown = true;
        this.capturePointer(event);
        if (!this.isActive()) {
          this.iconSrc = HAND_ACTIVE;
          this.cursorSrc = HAND_ACTIVE;
        }
      },
      onPointerUp(event) {
        this.isPointerDown = false;
        this.resetIconState();
        if (this.isMousePointer(event)) {
          this.releasePointer(event);
        }
      },
      onPointerLeave(event) {
        this.isPointerDown = false;
        this.resetIconState();
        if (this.isMousePointer(event)) {
          this.releasePointer(event);
        }
      },
      capturePointer(event) {
        if (
          !this.isMousePointer(event) ||
          !event ||
          !this.$refs.button ||
          typeof this.$refs.button.setPointerCapture !== 'function' ||
          event.pointerId === undefined
        ) {
          return;
        }
        try {
          this.$refs.button.setPointerCapture(event.pointerId);
        } catch (err) {}
      },
      releasePointer(event) {
        if (
          !this.isMousePointer(event) ||
          !event ||
          !this.$refs.button ||
          typeof this.$refs.button.releasePointerCapture !== 'function' ||
          event.pointerId === undefined
        ) {
          return;
        }
        try {
          this.$refs.button.releasePointerCapture(event.pointerId);
        } catch (err) {}
      },
      onKeyDown() {
        if (this.isActive()) {
          return;
        }
        this.iconSrc = HAND_ACTIVE;
      },
      onKeyUp() {
        this.resetIconState();
      },
      onBlur(event) {
        this.isPointerDown = false;
        this.resetIconState();
        this.releasePointer(event);
      },
      onMouseEnter(event) {
        if (!this.isDesktop) {
          return;
        }
        if (this.hideTimeout) {
          clearTimeout(this.hideTimeout);
          this.hideTimeout = null;
        }
        this.isHovering = true;
        this.setCursorVisible(true);
        this.moveCursorToAnchor(true);
        requestAnimationFrame(() => {
          this.setCursorPosition(event.clientX, event.clientY);
        });
      },
      onMouseLeave(event) {
        if (!this.isDesktop) {
          return;
        }
        this.isPointerDown = false;
        this.isHovering = false;
        this.moveCursorToAnchor();
        this.hideTimeout = setTimeout(() => {
          this.setCursorVisible(false);
          this.cursorSrc = this.handSrc();
        }, 80);
        this.releasePointer(event);
      },
      onMouseMove(event) {
        if (!this.isDesktop) {
          return;
        }
        if (!this.cursorVisible) {
          return;
        }
        this.setCursorPosition(event.clientX, event.clientY);
      },
      onMouseDown() {
        if (!this.isDesktop || this.isActive() || !this.cursorVisible) {
          return;
        }
        this.cursorSrc = HAND_ACTIVE;
      },
      onMouseUp() {
        if (!this.isDesktop || !this.cursorVisible) {
          return;
        }
        this.cursorSrc = this.handSrc();
      },
      resetIconState() {
        const src = this.handSrc();
        this.iconSrc = src;
        this.cursorSrc = src;
      },
      moveCursorToAnchor(instant = false) {
        const target = this.$refs.icon || this.$refs.button;
        if (!target) {
          return;
        }
        const rect = target.getBoundingClientRect();
        this.setCursorPosition(rect.left + rect.width / 2, rect.top + rect.height / 2, instant);
      },
      setCursorPosition(x, y, instant = false) {
        if (Number.isNaN(x) || Number.isNaN(y)) {
          return;
        }
        if (instant) {
          this.disableCursorTransition = true;
          this.cursorPosition = { x, y };
          requestAnimationFrame(() => {
            this.disableCursorTransition = false;
          });
        } else {
          this.cursorPosition = { x, y };
        }
      }
    }));

    Alpine.data('scheduleApp', () => ({
      daysOfWeek: DAY_NAMES,
      shows: window.WEBDCR_SHOWS || [],
      timeParser:
        window.webdcr && typeof window.webdcr.parseTimeToMinutes === 'function'
          ? window.webdcr.parseTimeToMinutes
          : () => NaN,
      groupedShows: {},
      activeDay: 'Sunday',
      nowMinutes: 0,
      currentDayName: DAY_NAMES[0],
      init() {
        this.prepareShows();
        this.setActiveDayToToday();
        this.updateCurrentTime();
        this.scheduleTicker();
      },
      prepareShows() {
        const base = {};
        this.daysOfWeek.forEach((day) => {
          base[day] = [];
        });
        this.groupedShows = base;
        (this.shows || []).forEach((show, index) => {
          const day = show && show['Day'] ? show['Day'].trim() : '';
          if (!day || !this.groupedShows[day]) {
            return;
          }
          const startMinutes = this.timeParser(show['Time']);
          if (Number.isNaN(startMinutes)) {
            return;
          }
          const normalized = {
            ...show,
            Day: day,
            Description: show['Description'] || '',
            hostLabel: show['Host(s)'] ? `with ${show['Host(s)']}` : '',
            imageSrc: this.sanitizeImagePath(show['Image name']),
            imageAlt: show['Name'] ? `${show['Name']} artwork` : 'Show artwork',
            displayTime: this.formatDisplayTime(startMinutes),
            startMinutes,
            uid: `${day}-${show['Name'] || 'show'}-${show['Time'] || 'time'}-${index}`
          };
          this.groupedShows[day].push(normalized);
        });
        Object.keys(this.groupedShows).forEach((day) => {
          const sorted = this.groupedShows[day].sort((a, b) => a.startMinutes - b.startMinutes);
          this.groupedShows[day] = this.insertProgrammingBreaks(sorted, day);
        });
      },
      insertProgrammingBreaks(shows, day) {
        if (!Array.isArray(shows) || shows.length === 0) {
          return [];
        }
        const result = [];
        for (let i = 0; i < shows.length; i++) {
          const current = shows[i];
          result.push(current);
          const next = shows[i + 1];
          if (!next) {
            continue;
          }
          if (typeof current.startMinutes !== 'number' || typeof next.startMinutes !== 'number') {
            continue;
          }
          const gap = next.startMinutes - current.startMinutes;
          if (gap > 60) {
            const breakStart = current.startMinutes + 60;
            const breakEnd = next.startMinutes;
            result.push(this.createProgrammingBreak(day, current, next, breakStart, breakEnd, i));
          }
        }
        return result;
      },
      createProgrammingBreak(day, currentShow, nextShow, breakStart, breakEnd, index) {
        return {
          isBreak: true,
          Day: day,
          Name: 'Programming Break',
          Description: '',
          hostLabel: '',
          imageSrc: '',
          imageAlt: '',
          displayTime: '',
          breakRange: this.formatBreakRange(breakStart, breakEnd),
          startMinutes: null,
          uid: `${day}-break-${currentShow && currentShow.uid ? currentShow.uid : index}`
        };
      },
      formatBreakRange(startMinutes, endMinutes) {
        if (
          typeof startMinutes !== 'number' ||
          Number.isNaN(startMinutes) ||
          typeof endMinutes !== 'number' ||
          Number.isNaN(endMinutes)
        ) {
          return '';
        }
        const startLabel = this.formatDisplayTime(startMinutes);
        const endLabel = this.formatDisplayTime(endMinutes);
        if (!startLabel || !endLabel) {
          return '';
        }
        return `${startLabel} â€“ ${endLabel}`;
      },
      selectDay(day) {
        if (this.daysOfWeek.includes(day)) {
          this.activeDay = day;
        }
      },
      hasShows(day) {
        return Array.isArray(this.groupedShows[day]) && this.groupedShows[day].length > 0;
      },
      isLive(show) {
        if (!show || typeof show.startMinutes !== 'number') {
          return false;
        }
        if (this.currentDayName !== show.Day) {
          return false;
        }
        return this.nowMinutes >= show.startMinutes && this.nowMinutes < show.startMinutes + 60;
      },
      formatDisplayTime(startMinutes) {
        if (typeof startMinutes !== 'number' || Number.isNaN(startMinutes)) {
          return '';
        }
        let hours = Math.floor(startMinutes / 60);
        const minutes = startMinutes % 60;
        const meridiem = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        if (hours === 0) {
          hours = 12;
        }
        return `${hours}:${minutes.toString().padStart(2, '0')} ${meridiem}`;
      },
      sanitizeImagePath(name) {
        if (!name) {
          return '/assets/images/showalbums/placeholder.png';
        }
        const trimmed = String(name).trim();
        if (!trimmed) {
          return '/assets/images/showalbums/placeholder.png';
        }
        const sanitized = encodeURIComponent(trimmed).replace(/%2F/g, '/');
        return `/assets/images/showalbums/${sanitized}`;
      },
      updateCurrentTime() {
        const easternNow = getEasternNow();
        this.nowMinutes = easternNow.minutes;
        this.currentDayName = easternNow.dayName || this.daysOfWeek[0];
      },
      scheduleTicker() {
        const now = new Date();
        const nextMinute = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          now.getHours(),
          now.getMinutes() + 1,
          0,
          0
        );
        const delay = Math.max(nextMinute.getTime() - now.getTime(), 250);
        setTimeout(() => {
          this.updateCurrentTime();
          this.scheduleTicker();
        }, delay);
      },
      setActiveDayToToday() {
        const easternNow = getEasternNow();
        this.activeDay = easternNow.dayName || this.daysOfWeek[0];
      }
    }));
  });
</script>
